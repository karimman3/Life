<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devis - LIFE CERAME</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            margin: 0;
            padding: 20px;
            direction: ltr;
            text-align: left;
        }
        .container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 800px;
            margin: auto;
        }
        h2 {
            text-align: center;
            color: #4CAF50;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .header div {
            font-size: 16px;
            font-weight: bold;
        }
        .client-info, .company-info, .table-container {
            margin-top: 20px;
        }
        label {
            font-weight: bold;
            display: inline-block;
            margin-bottom: 5px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .total {
            text-align: left;
            font-weight: bold;
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>LIFE CERAME</h2>
        <div class="header">
            <div>Devis</div>
            <div>Date: <input type="date" id="date"></div>
        </div>

        <div class="client-info">
            <label for="clientName">Nom du client:</label>
            <input type="text" id="clientName" placeholder="Entrez le nom du client">

            <label for="clientIce">ICE:</label>
            <input type="text" id="clientIce" placeholder="Entrez le numéro ICE">

            <label for="clientPhone">Numéro de téléphone:</label>
            <input type="text" id="clientPhone" placeholder="Entrez le numéro de téléphone">
        </div>

        <div class="company-info">
            <h3>Informations de la société</h3>
            <label for="companyPhone">Numéro de téléphone:</label>
            <input type="text" id="companyPhone" value="0660201206" readonly>

            <label for="companyEmail">Email:</label>
            <input type="email" id="companyEmail" value="lifecerame@gmail.com" readonly>

            <label for="companyAddress">Adresse:</label>
            <input type="text" id="companyAddress" value="lotissement riad ouled mtaa secteur 02 n° 382 temara" readonly>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ref</th>
                        <th>Description</th>
                        <th>Quantité</th>
                        <th>Prix TTC</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="itemsTable">
                    <tr>
                        <td>
                            <select id="ref1" onchange="updateProductDetails(1)">
                                <option value="">Sélectionner une référence</option>
                                <option value="1" data-desc="Carrelage blanc" data-price="100">Carrelage blanc</option>
                                <option value="2" data-desc="Carrelage noir" data-price="120">Carrelage noir</option>
                                <option value="3" data-desc="Carrelage gris" data-price="110">Carrelage gris</option>
                            </select>
                        </td>
                        <td><input type="text" id="desc1" placeholder="Description" readonly></td>
                        <td><input type="number" id="qty1" placeholder="Quantité" min="0" onchange="calculateTotal(1)"></td>
                        <td><input type="number" id="price1" placeholder="Prix TTC" min="0" onchange="calculateTotal(1)" readonly></td>
                        <td id="total1">0</td>
                    </tr>
                </tbody>
            </table>
            <div class="total">Total général: <span id="grandTotal">0</span> dirhams</div>
        </div>

        <button onclick="addRow()">Ajouter une nouvelle ligne</button>
        <button onclick="downloadPDF()">Télécharger le devis PDF</button>
    </div>

    <script>
        // تعيين تاريخ اليوم عند تحميل الصفحة
        window.onload = function() {
            document.getElementById("date").value = new Date().toISOString().split('T')[0];
        };

        function calculateTotal(row) {
            var qty = parseFloat(document.getElementById("qty" + row).value) || 0;
            var price = parseFloat(document.getElementById("price" + row).value) || 0;
            var total = qty * price;
            document.getElementById("total" + row).textContent = total.toFixed(2);

            // حساب المجموع الكلي
            var grandTotal = 0;
            var rows = document.querySelectorAll("#itemsTable tr");
            rows.forEach(function(row) {
                var totalCell = row.querySelector("td:last-child").textContent;
                grandTotal += parseFloat(totalCell) || 0;
            });
            document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
        }

        function updateProductDetails(row) {
            var select = document.getElementById("ref" + row);
            var selectedOption = select.options[select.selectedIndex];

            // الحصول على الوصف والسعر من البيانات المخزنة في الخيار
            var description = selectedOption.getAttribute("data-desc") || "";
            var price = selectedOption.getAttribute("data-price") || 0;

            // تحديث الحقول المناسبة
            document.getElementById("desc" + row).value = description;
            document.getElementById("price" + row).value = price;

            // إعادة حساب المجموع
            calculateTotal(row);
        }

        function addRow() {
            var table = document.getElementById("itemsTable");
            var rowCount = table.rows.length + 1;
            var row = table.insertRow();

            row.innerHTML = `
                <td>
                    <select id="ref${rowCount}" onchange="updateProductDetails(${rowCount})">
                        <option value="">Sélectionner une référence</option>
                        <option value="1" data-desc="Carrelage blanc" data-price="100">Carrelage blanc</option>
                        <option value="2" data-desc="Carrelage noir" data-price="120">Carrelage noir</option>
                        <option value="3" data-desc="Carrelage gris" data-price="110">Carrelage gris</option>
                    </select>
                </td>
                <td><input type="text" id="desc${rowCount}" placeholder="Description" readonly></td>
                <td><input type="number" id="qty${rowCount}" placeholder="Quantité" min="0" onchange="calculateTotal(${rowCount})"></td>
                <td><input type="number" id="price${rowCount}" placeholder="Prix TTC" min="0" onchange="calculateTotal(${rowCount})" readonly></td>
                <td id="total${rowCount}">0</td>
            `;
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;

            const doc = new jsPDF();
            const date = new Date(document.getElementById("date").value).toLocaleDateString('en-US'); // تغيير التاريخ إلى الإنجليزية
            const clientName = document.getElementById("clientName").value;
            const clientIce = document.getElementById("clientIce").value;
            const clientPhone = document.getElementById("clientPhone").value;
            const companyPhone = document.getElementById("companyPhone").value;
            const companyEmail = document.getElementById("companyEmail").value;
            const companyAddress = document.getElementById("companyAddress").value;
            const grandTotal = document.getElementById("grandTotal").textContent;
            
            doc.setFontSize(16);
            doc.text("LIFE CERAME", 20, 20);
            doc.setFontSize(12);
            doc.text(`Date: ${date}`, 20, 30);
            doc.text(`Nom du client: ${clientName}`, 20, 40);
            doc.text(`ICE: ${clientIce}`, 20, 50);
            doc.text(`Numéro de téléphone du client: ${clientPhone}`, 20, 60);
            doc.text(`Numéro de téléphone de la société: ${companyPhone}`, 20, 70);
            doc.text(`Email: ${companyEmail}`, 20, 80);
            doc.text(`Adresse: ${companyAddress}`, 20, 90);
            doc.text("Détails de la commande:", 20, 100);
            
            let y = 110; // Y position for the table
            doc.setFontSize(10);
            doc.text("Ref | Description | Quantité | Prix TTC | Total", 20, y);
            y += 10;
            
            const rows = document.querySelectorAll("#itemsTable tr");
            rows.forEach(row => {
            const ref = row.querySelector("select").value;
            const description = row.querySelector("input[readonly]").value;
            const quantity = row.querySelector("input[id^='qty']").value;
            const price = row.querySelector("input[id^='price']").value;
            const total = row.querySelector("td:last-child").textContent;
            
            if (ref) { // تأكد من أن هناك مرجع محدد
            doc.text(`${ref} | ${description} | ${quantity} | ${price} | ${total}`, 20, y);
            y += 10;
            }
            });
            
            doc.text(`Total général: ${grandTotal} dirhams`, 20, y);
            doc.save("devis.pdf");
            }
            </script>
            </body>
            </html>
